<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web IPTV Player - Versioni i Thjeshtuar</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: white; 
            padding: 20px;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        header { 
            text-align: center; 
            padding: 20px; 
            background: #333; 
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        h1 { color: #4CAF50; margin-bottom: 10px; }
        
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            flex: 1;
            min-width: 300px;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover { background: #45a049; }
        
        .player-container {
            background: black;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            height: 400px;
        }
        
        #video-player {
            width: 100%;
            height: 100%;
        }
        
        .channels-section {
            display: flex;
            gap: 20px;
            height: 400px;
        }
        
        .categories {
            width: 200px;
            background: #2a2a2a;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
        }
        
        .channels-list {
            flex: 1;
            background: #2a2a2a;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .category-item, .channel-item {
            padding: 10px;
            background: #333;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 5px;
        }
        
        .category-item:hover, .channel-item:hover {
            background: #444;
        }
        
        .category-item.active, .channel-item.playing {
            background: #4CAF50;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #4CAF50;
        }
        
        .error {
            background: #ff4444;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        @media (max-width: 768px) {
            .channels-section {
                flex-direction: column;
                height: auto;
            }
            .categories {
                width: 100%;
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∫ Web IPTV Player</h1>
            <p>Version i thjeshtuar q√´ punon 100%</p>
        </header>

        <div class="input-section">
            <div class="input-group">
                <h3>üìÅ M3U Playlist</h3>
                <input type="text" id="m3u-url" placeholder="Shkruaj URL e M3U playlist" value="https://iptv-org.github.io/iptv/countries/al.m3u">
                <button onclick="loadM3U()">Ngarko M3U</button>
            </div>

            <div class="input-group">
                <h3>üîë Xtream Codes</h3>
                <input type="text" id="server-url" placeholder="Server URL (http://...)" value="http://your-server.com:8080">
                <input type="text" id="username" placeholder="P√´rdoruesi">
                <input type="text" id="password" placeholder="Fjal√´kalimi">
                <button onclick="loginXtream()">Ky√ßu Xtream</button>
            </div>
        </div>

        <div class="error" id="error-message"></div>

        <div class="player-container">
            <video id="video-player" controls>
                <source src="" type="application/x-mpegURL">
                Shfletuesi juaj nuk mb√´shtet video HLS.
            </video>
        </div>

        <div class="channels-section">
            <div class="categories">
                <h3>üìÇ Kategorit√´</h3>
                <div id="categories-list">
                    <div class="category-item active" onclick="filterChannels()">T√´ Gjitha</div>
                </div>
            </div>
            
            <div class="channels-list" id="channels-grid">
                <div class="loading">Zgjedh nj√´ metod√´ p√´r t√´ ngarkuar kanalet</div>
            </div>
        </div>
    </div>

    <script>
        // Variabla globale
        let channels = [];
        let currentCategory = 'all';
        let currentPlayer = null;

        // Ngarko HLS.js n√´se √´sht√´ e disponueshme
        function initHLS() {
            if (typeof Hls !== 'undefined') {
                return new Hls({
                    enableWorker: true,
                    lowLatencyMode: true
                });
            }
            return null;
        }

        // Ngarko playlist M3U
        async function loadM3U() {
            const url = document.getElementById('m3u-url').value.trim();
            if (!url) {
                showError('Ju lutem shkruani nj√´ URL t√´ vlefshme');
                return;
            }

            try {
                showLoading('Duke ngarkuar playlist...');
                
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const text = await response.text();
                channels = parseM3U(text);
                
                if (channels.length === 0) {
                    throw new Error('Nuk u gjet√´n kanale n√´ playlist');
                }
                
                updateCategories();
                renderChannels();
                hideError();
                
            } catch (error) {
                showError('Gabim: ' + error.message);
            }
        }

        // Parsing i thjesht√´ i M3U
        function parseM3U(data) {
            const channels = [];
            const lines = data.split('\n');
            let currentChannel = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    currentChannel = {
                        id: i,
                        name: line.split(',').pop().trim(),
                        category: (line.match(/group-title="([^"]+)"/) || [])[1] || 'Other',
                        logo: (line.match(/tvg-logo="([^"]+)"/) || [])[1] || '',
                        url: ''
                    };
                } else if (currentChannel && line && !line.startsWith('#')) {
                    currentChannel.url = line.trim();
                    channels.push({...currentChannel});
                    currentChannel = null;
                }
            }

            return channels;
        }

        // Ky√ßu n√´ Xtream (version i thjeshtuar)
        async function loginXtream() {
            const server = document.getElementById('server-url').value.trim();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!server || !username || !password) {
                showError('Ju lutem plot√´soni t√´ gjitha fushat');
                return;
            }

            // K√´tu duhet t√´ vendosni serverin tuaj t√´ v√´rtet√´
            // Ky √´sht√´ vet√´m nj√´ shembull
            showError('Xtream API k√´rkon server t√´ v√´rtet√´. P√´rdorni M3U p√´r testim.');
        }

        // P√´rdit√´so list√´n e kategorive
        function updateCategories() {
            const container = document.getElementById('categories-list');
            container.innerHTML = '<div class="category-item active" onclick="filterChannels()">T√´ Gjitha</div>';
            
            // Merr kategorit√´ unike
            const categories = [...new Set(channels.map(c => c.category))];
            
            categories.forEach(category => {
                const div = document.createElement('div');
                div.className = 'category-item';
                div.textContent = category;
                div.onclick = () => filterChannels(category);
                container.appendChild(div);
            });
        }

        // Filtro kanalet sipas kategoris√´
        function filterChannels(category = 'all') {
            currentCategory = category;
            
            const filtered = category === 'all' 
                ? channels 
                : channels.filter(c => c.category === category);
            
            renderChannels(filtered);
            
            // P√´rdit√´so aktivitetin e kategorive
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Shfaq kanalet n√´ list√´
        function renderChannels(channelList = channels) {
            const container = document.getElementById('channels-grid');
            
            if (channelList.length === 0) {
                container.innerHTML = '<div class="loading">Nuk u gjet√´n kanale</div>';
                return;
            }
            
            container.innerHTML = '';
            
            channelList.forEach(channel => {
                const div = document.createElement('div');
                div.className = 'channel-item';
                div.innerHTML = `
                    <strong>${channel.name}</strong>
                    <br>
                    <small>${channel.category}</small>
                `;
                
                div.onclick = () => playChannel(channel);
                container.appendChild(div);
            });
        }

        // Luaj kanalin
        function playChannel(channel) {
            const player = document.getElementById('video-player');
            
            // P√´rdit√´so UI
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('playing');
            });
            event.target.classList.add('playing');
            
            // Ndrysho titullin e faqes
            document.title = `IPTV - ${channel.name}`;
            
            // Kontrollo n√´se HLS √´sht√´ e disponueshme
            if (Hls && Hls.isSupported()) {
                if (currentPlayer) {
                    currentPlayer.destroy();
                }
                
                currentPlayer = new Hls();
                currentPlayer.loadSource(channel.url);
                currentPlayer.attachMedia(player);
                currentPlayer.on(Hls.Events.MANIFEST_PARSED, () => {
                    player.play().catch(e => {
                        showError('Video nuk mund t√´ luhet: ' + e.message);
                    });
                });
                
            } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                // P√´r Safari
                player.src = channel.url;
                player.play().catch(e => {
                    showError('Video nuk mund t√´ luhet: ' + e.message);
                });
            } else {
                showError('Shfletuesi juaj nuk mb√´shtet HLS streaming');
            }
        }

        // Shfaq mesazh gabimi
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
            
            // Fshi pas 5 sekondash
            setTimeout(hideError, 5000);
        }

        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }

        // Shfaq loading
        function showLoading(message) {
            document.getElementById('channels-grid').innerHTML = 
                `<div class="loading">‚è≥ ${message}</div>`;
        }

        // Funksion p√´r t√´ testuar me nj√´ playlist test
        function loadTestPlaylist() {
            // Playlist test me disa kanale publike
            document.getElementById('m3u-url').value = 
                'https://iptv-org.github.io/iptv/categories/education.m3u';
            loadM3U();
        }

        // Inicializo
        window.onload = function() {
            // Ngarko HLS.js nga CDN
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/hls.js@latest';
            script.onload = function() {
                console.log('HLS.js u ngarkua me sukses');
            };
            document.head.appendChild(script);
            
            // Shto buton test
            const testBtn = document.createElement('button');
            testBtn.textContent = 'Test me Playlist Demo';
            testBtn.onclick = loadTestPlaylist;
            testBtn.style.marginLeft = '10px';
            testBtn.style.background = '#2196F3';
            document.querySelector('.input-group h3').appendChild(testBtn);
        };

        // Ekspozo funksionet globale
        window.loadM3U = loadM3U;
        window.loginXtream = loginXtream;
        window.filterChannels = filterChannels;
        window.playChannel = playChannel;
    </script>
</body>
</html>
