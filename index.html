<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Player - Version i Rregulluar</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
body { background:#121212; color:white; padding:20px; }
.container { max-width:1200px; margin:0 auto; }
header { text-align:center; margin-bottom:20px; }
header h1 { color:#00ff88; margin-bottom:5px; }
.tabs { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }
.tab { padding:10px 20px; background:#333; border-radius:5px; cursor:pointer; }
.tab.active { background:#00ff88; color:black; }
.tab-content { display:none; background:#1e1e1e; padding:20px; border-radius:10px; margin-bottom:20px; }
.tab-content.active { display:block; }
input, textarea, select, button { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:none; }
button { background:#00ff88; color:black; font-weight:bold; cursor:pointer; }
button:hover { background:#00cc6a; }

.player-container { background:black; border-radius:10px; overflow:hidden; margin-bottom:20px; height:400px; position:relative; }
#video-player { width:100%; height:100%; }
.channel-info { position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.7); padding:5px 10px; border-radius:5px; font-size:14px; }

.categories { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; justify-content:center; }
.cat-item { padding:8px 15px; background:rgba(255,255,255,0.1); border-radius:5px; cursor:pointer; }
.cat-item.active { background:#00ff88; color:black; }

.channels { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px; }
.channel-item { padding:10px; background:rgba(255,255,255,0.1); border-radius:5px; cursor:pointer; text-align:center; }
.channel-item.active { background:#00ff88; color:black; }
.channel-item img { width:50px; height:50px; border-radius:50%; margin-bottom:5px; }

.status { text-align:center; padding:10px; border-radius:5px; margin:10px 0; display:none; }
.status.success { background:rgba(0,255,136,0.2); border:1px solid #00ff88; display:block; }
.status.error { background:rgba(255,0,0,0.2); border:1px solid #ff4444; display:block; }
.status.loading { background:rgba(0,150,255,0.2); border:1px solid #0096ff; display:block; }
</style>
</head>
<body>
<div class="container">
<header>
    <h1>üì∫ IPTV Player</h1>
    <p>Punon me M3U lokale ose online</p>
</header>

<div class="tabs">
    <div class="tab active" onclick="showTab('m3u-tab', event)">M3U Playlist</div>
    <div class="tab" onclick="showTab('local-tab', event)">Skedar Lokal</div>
</div>

<!-- M3U Tab -->
<div id="m3u-tab" class="tab-content active">
    <input type="text" id="m3u-url" placeholder="https://example.com/playlist.m3u">
    <button onclick="loadM3UFromURL()">Ngarko M3U</button>
    <div class="status" id="m3u-status"></div>
</div>

<!-- Local Tab -->
<div id="local-tab" class="tab-content">
    <textarea id="m3u-example" rows="10" style="background:#222;color:#fff;">#EXTM3U
#EXTINF:-1 tvg-id="Test1" tvg-name="Test Channel 1" tvg-logo="https://img.icons8.com/color/48/000000/tv.png" group-title="Test",Test Channel 1
https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8</textarea>
    <button onclick="useExample()">P√´rdor Shembull</button>
    <div class="status" id="local-status"></div>
</div>

<div class="player-container">
    <video id="video-player" controls playsinline></video>
    <div class="channel-info" id="channel-info">Zgjidhni nj√´ kanal</div>
</div>

<div class="categories" id="categories-list">
    <div class="cat-item active" onclick="filterByCategory('all', event)">T√´ Gjitha</div>
</div>

<div class="channels" id="channels-list">
    <div style="text-align:center;padding:50px;color:#ff9900;">Zgjidh nj√´ playlist p√´r t√´ par√´ kanalet</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
let channels = [];
let currentChannel = null;
let currentCategory = 'all';
let hlsPlayer = null;

// Tabs
function showTab(tabId, e) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    e.currentTarget.classList.add('active');
}

// Load M3U from URL
async function loadM3UFromURL() {
    const url = document.getElementById('m3u-url').value.trim();
    if(!url){ showStatus('m3u-status','Ju lutem shkruani URL','error'); return; }
    showStatus('m3u-status','Duke ngarkuar...','loading');
    try {
        const resp = await fetch(url);
        const data = await resp.text();
        processM3UData(data);
        showStatus('m3u-status',`‚úÖ U ngarkuan ${channels.length} kanale`,'success');
    } catch(e){
        showStatus('m3u-status','‚ùå Gabim: '+e.message,'error');
    }
}

// Use example
function useExample(){
    const text = document.getElementById('m3u-example').value;
    processM3UData(text);
    showStatus('local-status','‚úÖ Shembulli u ngarkua','success');
    showTab('m3u-tab', document.querySelector('.tab.active'));
}

// Process M3U
function processM3UData(data){
    channels = parseM3U(data);
    if(channels.length===0) { alert('Nuk u gjet√´n kanale'); return; }
    updateCategories();
    renderChannels();
}

// Parse M3U
function parseM3U(data){
    const list=[];
    const lines=data.split('\n');
    let ch=null;
    for(let i=0;i<lines.length;i++){
        const line=lines[i].trim();
        if(line.startsWith('#EXTINF:')){
            ch={};
            ch.name=line.split(',').pop().trim();
            ch.category=(line.match(/group-title="([^"]+)"/)||[])[1]||'Other';
            ch.logo=(line.match(/tvg-logo="([^"]+)"/)||[])[1]||'';
            ch.url='';
            ch.id=i+Date.now();
        } else if(ch && line && !line.startsWith('#')){
            ch.url=line;
            list.push(ch);
            ch=null;
        }
    }
    return list;
}

// Categories
function updateCategories(){
    const container=document.getElementById('categories-list');
    container.innerHTML='<div class="cat-item active" onclick="filterByCategory(\'all\',event)">T√´ Gjitha</div>';
    [...new Set(channels.map(c=>c.category))].forEach(cat=>{
        const div=document.createElement('div');
        div.className='cat-item';
        div.textContent=cat;
        div.onclick=(e)=>filterByCategory(cat,e);
        container.appendChild(div);
    });
}

function filterByCategory(category,e){
    currentCategory=category;
    document.querySelectorAll('.cat-item').forEach(c=>c.classList.remove('active'));
    if(e) e.currentTarget.classList.add('active');
    renderChannels(category==='all'?channels:channels.filter(c=>c.category===category));
}

// Render channels
function renderChannels(list=channels){
    const container=document.getElementById('channels-list');
    if(!list || list.length===0){
        container.innerHTML='<div style="text-align:center;padding:50px;color:#ff9900;">Nuk u gjet√´n kanale</div>';
        return;
    }
    container.innerHTML='';
    list.forEach(ch=>{
        const div=document.createElement('div');
        div.className='channel-item';
        div.innerHTML=`${ch.logo?`<img src="${ch.logo}" onerror="this.src='https://img.icons8.com/color/48/000000/tv.png'">`:''}<div>${ch.name}</div><small style="color:#aaa">${ch.category}</small>`;
        div.addEventListener('click',()=>playChannel(ch,div));
        container.appendChild(div);
    });
}

// Play channel
function playChannel(ch,el){
    currentChannel=ch;
    document.querySelectorAll('.channel-item').forEach(c=>c.classList.remove('active'));
    if(el) el.classList.add('active');
    document.getElementById('channel-info').textContent=`üé¨ ${ch.name} | üìÇ ${ch.category}`;
    playStream(ch.url);
}

// Play stream
function playStream(url){
    const video=document.getElementById('video-player');
    if(hlsPlayer){ hlsPlayer.destroy(); hlsPlayer=null; }
    video.pause();
    video.src='';
    if(!url || !url.startsWith('http')) return;
    if(url.includes('.m3u8')){
        if(Hls.isSupported()){
            hlsPlayer=new Hls();
            hlsPlayer.loadSource(url);
            hlsPlayer.attachMedia(video);
            hlsPlayer.on(Hls.Events.MANIFEST_PARSED,()=>video.play().catch(()=>{}));
        } else if(video.canPlayType('application/vnd.apple.mpegurl')){
            video.src=url;
            video.play().catch(()=>{});
        } else { alert('Shfletuesi nuk mb√´shtet HLS'); }
    } else {
        video.src=url;
        video.play().catch(()=>{});
    }
}

// Status
function showStatus(id,msg,type){
    const el=document.getElementById(id);
    el.textContent=msg;
    el.className='status '+type;
    if(type!=='loading') setTimeout(()=>el.className='status',5000);
}

// Init test
window.onload=function(){
    document.getElementById('m3u-url').value='https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8';
};
</script>
</body>
</html>
